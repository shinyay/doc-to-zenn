---
title: "100æ—¥å¾Œã«Rustã‚’ã¡ã‚‡ã£ã¨çŸ¥ã£ã¦ã‚‹äººã«ãªã‚‹: [Day 91]"
emoji: "ğŸ¦€"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: [rust]
published: false
---
## Day 91 ã®ãƒ†ãƒ¼ãƒ

æ™‚ãŒéãã‚‹ã®ã¯æ—©ã„ã‚‚ã®ã§ã€æ°—ãŒã¤ãã¨ Rust ã®å­¦ç¿’ã‚’åˆã‚ã¦ 90 æ—¥ãŒçµŒã£ã¦ã„ã¾ã—ãŸã€‚ã¡ã‚‡ã£ã¨åˆ†ã‹ã£ã¦ãã¦ã‚‹ã®ã‹ã©ã†ã‹ã¯ãŠã„ã¦ãŠã„ãŸã¨ã—ã¦ã‚‚ã€Rust é–¢é€£ã®è¨˜äº‹ã‚„æ›¸ç±ã‚’èª­ã‚“ã§ã‚‚ãªã‚“ã¨ã‹ã¤ã„ã¦ã„ã‘ã‚‹äº‹ãŒå¤šããªã£ã¦ãã¦ã„ã‚‹ã¨ã¯æ€ã„ã¾ã™ã€‚
ãã‚“ãªä¸­ã€ã¾ãŸæ–°ã—ã Rust ã®æœ¬ã‚’å…¥æ‰‹ã—ãŸã®ã§ã•ãã£ã¨ç›®ã‚’é€šã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚

![](https://storage.googleapis.com/zenn-user-upload/0abe692735b6-20221220.png)

## Webã‚¢ãƒ—ãƒªé–‹ç™ºã§å­¦ã¶ Rustè¨€èªå…¥é–€

ä»Šå›èª­ã‚‚ã†ã¨ã—ã¦ã„ã‚‹ã®ã¯ã€ç§€å’Œã‚·ã‚¹ãƒ†ãƒ ã‹ã‚‰å‡ºç‰ˆã•ã‚Œã¦ã„ã‚‹ã€ã€ŒWebã‚¢ãƒ—ãƒªé–‹ç™ºã§å­¦ã¶ Rustè¨€èªå…¥é–€ã€ã§ã™ã€‚

- [Webã‚¢ãƒ—ãƒªé–‹ç™ºã§å­¦ã¶ Rustè¨€èªå…¥é–€](shuwasystem.co.jp/book/9784798067315.html)

ã“ã®æœ¬ã®å†…å®¹ã¯ã€Webé–‹ç™ºçµŒé¨“ãŒã‚ã‚‹æ–¹ã‚’å¯¾è±¡ã«ã€Rustã®åŸºç¤æ–‡æ³•ã‹ã‚‰ã€Webã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é–‹ç™ºã¾ã§ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«å½¢å¼ã§ä½“é¨“å­¦ç¿’ã§ãã‚‹å…¥é–€æ›¸ã¨ãªã£ã¦ã„ã¾ã™ã€‚ã¨ã„ã†ã‚ã‘ã§ã€ã“ã®æœ¬ã‚’èª­ã‚“ã§ Web ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®é–‹ç™ºã«ã¤ã„ã¦å­¦ã‚“ã§ã¿ã‚ˆã†ã‹ãªã¨æ€ã„ã¾ã™ã€‚

### ç›®æ¬¡

æœ¬ã®æ§‹æˆã¯æ¬¡ã®ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚

- **ç¬¬ 1 ç«  Rustã¨Webé–‹ç™º**
  - 1.1 Rustã§ã®é–‹ç™ºã®æº–å‚™
- **ç¬¬ 2 ç«  RuståŸºç¤**
  - 2.1 å¤‰æ•°ã¨ãƒ‡ãƒ¼ã‚¿å‹
  - 2.2 é–¢æ•°ã®å®Ÿè£…
  - 2.3 åˆ¶å¾¡æ§‹é€ 
  - 2.4 æ‰€æœ‰æ¨©ã«ã‚ˆã‚‹å®‰å…¨æ€§
  - 2.5 ãƒ‡ãƒ¼ã‚¿æ§‹é€ 
  - 2.6 async/await
  - 2.7 ã‚¯ãƒ¬ãƒ¼ãƒˆã¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
  - 2.8 ãƒ†ã‚¹ãƒˆ
  - 2.9 ã‚ˆãä½¿ã†ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
- **ç¬¬ 3 ç«  axumã‚’ä½¿ã£ã¦httpãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å‡¦ç†ã™ã‚‹**
  - 3.1 axumã¨ã¯
  - 3.2 ç’°å¢ƒæ§‹ç¯‰
  - 3.3 ãƒ†ã‚¹ãƒˆ
  - 3.4 Todoæƒ…å ±ã‚’ä¿å­˜ã™ã‚‹
  - 3.5 httpãƒªã‚¯ã‚¨ã‚¹ãƒˆ
  - 3.6 ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã®è¿½åŠ 
- **ç¬¬ 4 ç«  sqlxã‚’ä½¿ã£ã¦CRUDã‚’å®Ÿè£…ã™ã‚‹**
  - 4.1 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åŸºç¤
  - 4.2 sqlxã¨ã¯
  - 4.3 axumã¨sqlx
  - 4.4 todoã®CRUD
  - 4.5 sqlxã®ãƒ†ã‚¹ãƒˆ
- **ç¬¬ 5 ç«  Todoã‚¢ãƒ—ãƒªã®ä½“è£ã‚’æ•´ãˆã‚‹**
  - 5.1 ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰é–‹ç™º
  - 5.2 Reactç’°å¢ƒæ§‹ç¯‰
  - 5.3 Todoã‚¢ãƒ—ãƒªã®UIå®Ÿè£…
  - 5.4 å¤–éƒ¨APIã¨ã®é€šä¿¡ï¼ˆ1ï¼‰
  - 5.5 å¤–éƒ¨APIã¨ã®é€šä¿¡ï¼ˆ2ï¼‰
- **ç¬¬ 6 ç«  Todoã«ãƒ©ãƒ™ãƒ«ã‚’ã¤ã‘ã‚‹**
  - 6.1 ãƒ©ãƒ™ãƒ«ã®CRUD
  - 6.2 TodoRepositoryã®ãƒ©ãƒ™ãƒ«å¯¾å¿œ
  - 6.3 ãƒ©ãƒ™ãƒ«æ©Ÿèƒ½ã‚’ç”»é¢ã«è¿½åŠ ã™ã‚‹
  - 6.4 ã•ã‚‰ãªã‚‹æ©Ÿèƒ½æ‹¡å¼µ

ã“ã®ç›®æ¬¡ã‚’è¦‹ã‚‹é™ã‚Šã ã¨ã€1 ç«  ã¨ 2 ç«  ã¯åŸºæœ¬çš„ãªæ–‡æ³•ã®è§£èª¬ãªã®ã§ã€ä»–ã®æ›¸ç±ã‚„è¨˜äº‹ãªã©ã§æ—¢ã«ç›®ã‚’é€šã—ãŸã“ã¨ãŒã‚ã‚‹å†…å®¹ã ã¨æ€ã„ã¾ã™ã€‚ã ã‹ã‚‰ã€ä»Šå›ã¯ 3 ç« ã‹ã‚‰èª­ã‚“ã§ã„ã“ã†ã¨æ€ã„ã¾ã™ã€‚

## ç¬¬ 3 ç«  axumã‚’ä½¿ã£ã¦httpãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å‡¦ç†ã™ã‚‹ - 3.1 axumã¨ã¯

ç¬¬ 3 ç«  ã§ã¯ã€Web ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã® **axum** ã‚’ä½¿ã£ã¦ Web ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æ§‹ç¯‰ã—ã¦ã„ãæ–¹æ³•ãŒç´¹ä»‹ã•ã‚Œã¦ã„ã¾ã™ã€‚

Web ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã«ã¤ã„ã¯ã€ä»¥å‰ [Day 36](https://zenn.dev/shinyay/articles/hello-rust-day036) ã‚„ [Day 37](https://zenn.dev/shinyay/articles/hello-rust-day037) ã§ç°¡å˜ã«ç¢ºèªã—ãŸã“ã¨ãŒã‚ã‚Šã¾ã—ãŸã€‚ãã®éš›ã«ã€è©³ç´°ã«ã¯è¦‹ã¾ã›ã‚“ã§ã—ãŸãŒ **axum** ã«ã¤ã„ã¦ã‚‚ç¢ºèªã¯ã—ã¦ã„ã¾ã—ãŸã€‚

- [GitHub:tokio-rs/axum](https://github.com/tokio-rs/axum)

ã“ã® axum ã¯ éåŒæœŸãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§æœ‰åãª **tokio** ã®é–‹ç™ºãƒãƒ¼ãƒ ã«ã‚ˆã‚‹ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã•ã‚Œã¦ã„ã‚ã‚‹ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã§ã™ã€‚äººé–“å·¥å­¦ã¨ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æ€§ã«é‡ç‚¹ã‚’ç½®ã„ã¦ã„ã‚‹ã¨ã„ã†ã“ã¨ãŒç‰¹å¾´ã®ã‚ˆã†ã§ã™ã€‚

- ç‰¹å¾´âœ¨
  - âœ… ãƒã‚¯ãƒ­ä¸è¦ã®APIã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ãƒãƒ³ãƒ‰ãƒ©ã«ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
  - âœ… ã‚¨ã‚¯ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚’ä½¿ã£ãŸå®£è¨€çš„ãªãƒªã‚¯ã‚¨ã‚¹ãƒˆã®è§£æ
  - âœ… ã‚·ãƒ³ãƒ—ãƒ«ã§äºˆæ¸¬å¯èƒ½ãªã‚¨ãƒ©ãƒ¼å‡¦ç†ãƒ¢ãƒ‡ãƒ«
  - âœ… æœ€å°é™ã®å®šå‹æ–‡ã«ã‚ˆã‚‹ãƒ¬ã‚¹ãƒãƒ³ã‚¹ç”Ÿæˆ
  - âœ… ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã€ã‚µãƒ¼ãƒ“ã‚¹ã€ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã® **tower** ãŠã‚ˆã³ **tower-http** ã‚¨ã‚³ã‚·ã‚¹ãƒ†ãƒ ã‚’ãƒ•ãƒ«ã«æ´»ç”¨

### axum ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ

`cargo add` ã§ä»¥ä¸‹ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’è¿½åŠ ã—ã¾ã™ã€‚

- **hyper**
  - HTTP ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®å‡¦ç†
- **tower**
  - ã‚µãƒ¼ãƒæ§‹ç¯‰é–¢é€£
- **serde, serde_json**
  - JSON ãƒ‘ãƒ¼ã‚¹å‡¦ç†é–¢é€£
- **mime**
  - HTTP ãƒ˜ãƒƒãƒ€ã® MIME å®šç¾©é–¢é€£
- **tracing, tracing-subscriber**
  - ãƒ­ã‚®ãƒ³ã‚°ãƒ»ãƒ‡ãƒãƒƒã‚°å‡¦ç†
- **anyhow, thiserror**
  - Result ã‚’æ‰±ã„ã‚„ã™ãã™ã‚‹ ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£

```shell
cargo add axum
cargo add hyper --features full
cargo add tokio --features full
cargo add tower
cargo add mime
cargo add serde --features derive
cargo add serde_json
cargo add tracing
cargo add tracing-subscriber --features env-filter
cargo add anyhow
cargo add thiserror
```

æ¬¡ã®ã‚ˆã†ãª `Cargo.toml` ãŒã§ãã‚ãŒã‚Šã¾ã—ãŸã€‚

```toml
[dependencies]
anyhow = "1.0.68"
axum = "0.6.1"
hyper = { version = "0.14.23", features = ["full"] }
mime = "0.3.16"
serde = { version = "1.0.151", features = ["derive"] }
serde_json = "1.0.91"
thiserror = "1.0.38"
tokio = { version = "1.23.0", features = ["full"] }
tower = "0.4.13"
tracing = "0.1.37"
tracing-subscriber = { version = "0.3.16", features = ["env-filter"] }
```

### axum Web ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚µãƒ³ãƒ—ãƒ«

axum ã‚’ç”¨ã„ãŸã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ã€æœ€ã‚‚ã‚·ãƒ³ãƒ—ãƒ«ãªã‚‚ã®ã¯æ¬¡ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã«ãªã‚Šã¾ã™ã€‚èµ·å‹•ã—ã¦ã€GET ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ã€ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã—ãŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¿”ã™ã€ã¨ã„ã†ã‚‚ã®ã§ã™ã€‚

```rust
use std::net::SocketAddr;
use axum::Router;
use axum::routing::get;

#[tokio::main]
async fn main() {

    let app = Router::new().route("/", get(root));
    let addr = SocketAddr::from(([127, 0, 0, 1], 3000));

    axum::Server::bind(&addr)
        .serve(app.into_make_service())
        .await
        .unwrap();
}

async fn root() -> &'static str {
    "Hello, axum!"
}
```

#### Route

```rust
let app = Router::new().route("/", get(root));
```

`Route` ã® `route` ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ã£ã¦ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è¨­å®šã‚’è¡Œã„ã¾ã™ã€‚

- **ç¬¬ä¸€å¼•æ•°**: URL ãƒ‘ã‚¹ã®ãƒãƒƒãƒãƒ³ã‚°
- **ç¬¬äºŒå¼•æ•°**: ãƒãƒƒãƒæ™‚ã«å‘¼ã³å‡ºã™é–¢æ•°

`axum::routing::get` ã¯ã€GET ãƒ¡ã‚½ãƒƒãƒ‰ã«ã‚ˆã‚‹ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¡Œã£ãŸå ´åˆã®å‘¼ã³å‡ºã—ã§ã™ã€‚
åŒæ§˜ã«ã€`axum::routing::post` ãªã‚‰ã°ã€POST ãƒ¡ã‚½ãƒƒãƒ‰ã«ã‚ˆã‚‹ã‚¢ã‚¯ã‚»ã‚¹ã‚’è¡Œã£ãŸå ´åˆã¨ãªã‚Šã¾ã™ã€‚
ã“ã®ç¬¬äºŒå¼•æ•°ã¯ã€æ¬¡ã®ã‚ˆã†ã«ãƒ¡ã‚½ãƒƒãƒ‰ãƒã‚§ãƒ¼ãƒ³ã‚’ç”¨ã„ã¦ã€HTTP ãƒ¡ã‚½ãƒƒãƒ‰å„ç¨®ã‚’å®šç¾©ã™ã‚‹ã“ã¨ãŒå¯èƒ½ã§ã™ã€‚

```rust
Router::new().route("/",
    get(get_handler)
    .post(post_handler)
    );
```

#### SockerAddr

```rust
let addr = SocketAddr::from(([127, 0, 0, 1], 3000));
```

`from` ãƒ¡ã‚½ãƒƒãƒ‰ã«ã‚ˆã‚Šã€`SocketAddr` ã¸ã®å¤‰æ›ã‚’è¡Œã„ã¾ã™ã€‚

- **ç¬¬ä¸€å¼•æ•°**: IpAddrå¤‰æ›å¯èƒ½ãªå‹
- **ç¬¬äºŒå¼•æ•°**: ãƒãƒ¼ãƒˆç•ªå·

ã¤ã¾ã‚Šã€ã“ã®ä¾‹ã§ã¯ IPv4 ã® `127.0.0.1:3000` ã‚’è¡¨ã—ã¦ã„ã¾ã™ã€‚

#### Server

```rust
axum::Server::bind(&addr)
    .serve(app.into_make_service())
    .await
    .unwrap();
```

- `bind(&addr)`: ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ã‚µãƒ¼ãƒã«ãƒã‚¤ãƒ³ãƒ‰
- `serve(app.into_make_service())`: ã‚µãƒ¼ãƒã®èµ·å‹•å‡¦ç†
- `await`: éåŒæœŸã«å¾…å—ã‘

## Day 91 ã®ã¾ã¨ã‚
